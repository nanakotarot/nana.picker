<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>幸運抽籤與分組神器</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css?v=5">
</head>

<body>

    <div class="bg-gradient-orbs">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>
    <canvas id="confetti-canvas"></canvas>

    <nav class="navbar">
        <div class="brand">
            <h1>幸運抽籤與分組神器</h1>
            <span class="member-badge" id="globalCount">0 人</span>
        </div>
        <div class="nav-menu">
            <div class="nav-item active" onclick="switchTab('list')">名單管理</div>
            <div class="nav-item" onclick="switchTab('draw')">幸運抽籤</div>
            <div class="nav-item" onclick="switchTab('group')">自動分組</div>
        </div>
    </nav>

    <div class="main-container">

        <!-- View 1: List -->
        <div id="view-list" class="view-section active">
            <div class="card-std">
                <h3 style="margin-bottom:1rem;">✏️ 輸入姓名</h3>
                <textarea id="nameInput" placeholder="一行一個名字...">陳大文
林小美
張志明
王曉華
李建國
楊宗緯
許瑋甯
鄭伊健
周杰倫
蔡依林
五月天</textarea>
                <div style="display:flex; gap:0.5rem; margin-top:0.5rem;">
                    <button class="btn-ghost" onclick="addExampleData()" style="flex:1; font-size:0.9rem;">
                        📝 載入範例
                    </button>
                    <button class="btn-ghost" onclick="removeDuplicates()"
                        style="flex:1; font-size:0.9rem; color:#ff4757;">
                        🧹 移除重複
                    </button>
                </div>
                <div style="margin-top:1rem;">
                    <button class="btn-action" style="width:100%; border-radius:12px; justify-content:center;"
                        onclick="switchTab('draw')">確認並開始抽籤</button>
                </div>
            </div>
            <div class="card-std">
                <h3 style="margin-bottom:1rem;">📋 目前名單</h3>
                <div class="list-container" id="listPreview"></div>
            </div>
        </div>

        <!-- View 2: Draw -->
        <div id="view-draw" class="view-section">
            <div class="draw-container">
                <div class="header-lg">
                    <h2>幸運抽籤</h2>
                    <p class="draw-stats">
                        目前名單: <span id="poolCount">0</span> 人 | 剩餘候選: <span id="remainingCount"
                            style="color:var(--primary); font-weight:700;">0</span> 人
                    </p>
                </div>

                <div class="result-card-lg">
                    <div class="display-area">
                        <div class="winner-label">THE WINNER IS</div>
                        <div id="winnerText" class="winner-text">???</div>
                    </div>

                    <div class="controls-footer">
                        <label style="display:flex; align-items:center; gap:0.5rem; cursor:pointer; color:#666;">
                            <input type="checkbox" id="allowDuplicate"
                                style="width:18px; height:18px; accent-color:var(--primary);">
                            允許重複中獎
                        </label>

                        <div style="display:flex; align-items:center; gap:1rem;">
                            <div style="font-size:0.9rem; color:#888;">
                                一次抽 <input type="number" id="drawPerRound" value="1" min="1" max="10"
                                    style="width:40px; padding:4px; text-align:center; border:1px solid #ddd; border-radius:4px;">
                                人
                            </div>
                            <button id="drawBtn" class="btn-action" onclick="performDraw()">
                                <svg style="width:20px;height:20px;fill:white;" viewBox="0 0 24 24">
                                    <path d="M8 5v14l11-7z" />
                                </svg>
                                開始抽獎
                            </button>
                        </div>
                    </div>
                </div>

                <div id="drawHistory"
                    style="margin-top:2rem; width:100%; display:flex; flex-wrap:wrap; gap:0.5rem; justify-content:center;">
                </div>
            </div>
        </div>

        <!-- View 3: Group (Redesigned) -->
        <div id="view-group" class="view-section">
            <div class="header-lg">
                <h2>自動分組</h2>
                <p>將 <span id="groupTotalCount">0</span> 位人員隨機分配到不同組別</p>
            </div>

            <div class="group-control-card">
                <div class="group-control-row">
                    <!-- Mode Switcher -->
                    <div class="mode-switch-container">
                        <div class="mode-option" id="modeCount" onclick="setGroupMode('count')">分成幾組</div>
                        <div class="mode-option active" id="modeSize" onclick="setGroupMode('size')">
                            <span class="check-icon">✓</span> 每組幾人
                        </div>
                    </div>

                    <!-- Number Input -->
                    <div class="number-input-wrapper">
                        <input type="number" id="groupNumberInput" class="number-input-simple" value="3" min="1">
                    </div>

                    <!-- Action Button -->
                    <button class="btn-group-action" onclick="performGroup()">分組</button>
                </div>

                <div class="estimation-text">
                    <span id="estGroupCount" style="font-weight:700; color:var(--text-main);"></span>
                </div>
            </div>

            <div class="results-section">
                <div class="results-header-row">
                    <h3>分組結果</h3>
                    <div style="display:flex; gap:0.5rem;">
                        <button class="btn-ghost" onclick="copyGroupText()">
                            <svg style="width:16px;height:16px;fill:currentColor;" viewBox="0 0 24 24">
                                <path
                                    d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
                            </svg> 複製文字
                        </button>
                        <!-- CSV Download (Mock) -->
                        <button class="btn-ghost" onclick="alert('CSV 下載功能已準備就緒！')">
                            <svg style="width:16px;height:16px;fill:currentColor;" viewBox="0 0 24 24">
                                <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z" />
                            </svg> 下載 CSV
                        </button>
                    </div>
                </div>

                <div id="groupResultGrid" class="group-grid">
                    <!-- Cards will go here -->
                </div>
            </div>
        </div>

    </div>

    <script src="script.js?v=5"></script>
    </script>
</body>

</html>